
Level 3（XBRL解析・データ抽出）までの実装、非常に意欲的ですね！ここを突破できれば、単なるダウンローダーではなく、\*\*「真に使える財務分析エンジン」\*\*になります。

有価証券報告書（XBRL）に含まれるデータは膨大（数千項目）ですが、\*\*株価分析（ファンダメンタルズ分析）**においてシステム的に抽出・監視すべき重要項目は、実は**「30〜50項目」\*\*程度に絞り込めます。

ライブラリ開発のターゲットとすべき項目を、重要度別に「松・竹・梅」で整理しました。

-----

### 【松】 絶対に外せない基本の財務数値 (約15〜20項目)

これらは多くの企業でタグ（Element Name）が共通化されており、取得難易度が比較的低く、かつ分析効果が絶大です。まずはここを確実に抜けるように設計します。

**取得先:** `jpcrp_cor:KeyFinancialData`（主要な経営指標等の推移）周辺
※財務諸表本体よりも、このサマリーテーブルの方がデータが正規化されていて抜きやすいです。

| カテゴリ | 項目名 (日本語) | XBRLタグの例 (名前空間省略) | 分析用途 |
| :--- | :--- | :--- | :--- |
| **収益性** | **売上高** | `NetSales` | 成長率の計算 |
| | **営業利益** | `OperatingIncome` | 本業の儲け（最重要） |
| | **経常利益** | `OrdinaryIncome` | 日本独自指標。実力値 |
| | **親会社株主に帰属する当期純利益** | `ProfitAttributableToOwnersOfParent` | PER計算の分母 |
| **安全性** | **純資産額** | `NetAssets` | 自己資本比率の計算 |
| | **総資産額** | `TotalAssets` | ROAの計算 |
| **投資指標** | **1株当たり純資産 (BPS)** | `NetAssetsPerShare` | PBR計算の分母 |
| | **1株当たり当期純利益 (EPS)** | `BasicEarningsPerShare` | PER計算の分母 |
| | **1株当たり配当額** | `DividendPerShare` (※別テーブルの場合あり) | 配当利回り |
| **CF** | **営業CF** | `CashFlowsFromOperatingActivities` | 黒字倒産リスク判定 |
| | **投資CF** | `CashFlowsFromInvestingActivities` | 成長投資の有無 |
| | **財務CF** | `CashFlowsFromFinancingActivities` | 借金返済か調達か |

-----

### 【竹】 分析の精度を上げる詳細データ (約10〜20項目)

「松」でスクリーニングした後の、詳細分析に使います。ここは企業によってタグが少しブレることがあります。

**取得先:** 財務諸表本表 (`jppfs_cor`) や、注記情報

| カテゴリ | 項目名 | 分析用途 |
| :--- | :--- | :--- |
| **効率性** | **自己資本** (Equity) | 正確なROE計算（純資産には新株予約権などが混じるため） |
| | **有利子負債** | ネットD/Eレシオ、財務健全性の詳細評価 |
| **コスト構造** | **売上原価** | 原価率の推移（インフレ耐性） |
| | **販管費** | コストコントロール力 |
| | **研究開発費** | 将来の競争力の源泉 |
| **その他** | **減価償却費** | EBITDA（営業利益＋減価償却費）の算出に必須 |
| | **のれん (Goodwill)** | 買収リスクの評価 |
| | **発行済株式総数** | 時価総額の正確な算出 |

-----

### 【梅】 定性情報・テキストデータ (数は少ないが処理が重い)

数値ではなく「文章」として取得し、LLM等に食わせるためのデータです。

| 項目名 | XBRLタグの目安 | 用途 |
| :--- | :--- | :--- |
| **事業等のリスク** | `BusinessRisksTextBlock` | リスク要因の要約・センチメント分析 |
| **経営者による分析 (MD\&A)** | `ManagementAnalysisOfFinancialPosition...` | 経営陣の自信度、見通しの理由 |
| **対処すべき課題** | `IssuesToAddressTextBlock` | 今後の戦略の方向性 |

-----

### 開発時の「最大の壁」：ContextとNamespace

TypeScriptでライブラリ化する際、単に「タグ名」を指定するだけではデータは取れません。ここがLv3の正念場です。

#### 1\. Context（文脈）の判定

XBRLには同じ `NetSales` というタグが複数回登場します。「連結なのか単体なのか」「今年なのか去年なのか」を判別するために `contextRef` 属性を見る必要があります。

  * **CurrentYearConsolidatedDuration** (当期・連結・期間) ← **これが欲しい**
  * PriorYearConsolidatedDuration (前期・連結・期間)
  * CurrentYearNonConsolidatedDuration (当期・単体・期間)

**ライブラリとしての解決策案:**

```typescript
// ユーザーにはこう書かせたい
const sales = edinet.getValue({
  tag: 'NetSales',
  context: 'CurrentYear', // ライブラリ側で適切なcontextRefを探しに行くロジックが必要
  scope: 'Consolidated'   // 連結優先
});
```

#### 2\. Namespace（名前空間）の揺らぎ

  * 会社情報系は `jpcrp_cor`
  * 財務諸表系は `jppfs_cor`
  * さらに、IFRS適用企業（トヨタやソフトバンクなど）は `ifrs-full` という全く別のタグ体系を使います。

**ライブラリの設計指針:**
まずは\*\*「日本基準 (J-GAAP)」\*\*に絞って実装することを強くお勧めします。IFRS対応まで最初からやると完成しません。

### まとめ：ライブラリが提供すべき機能

Lv3を目指すなら、以下の情報を「プロパティ」として持ったオブジェクトを返すのが理想です。

1.  **会社属性:** 会社名、証券コード、決算期
2.  **主要指標 (KeyMetrics):** 売上、営業利益、純利益、EPS、BPS、配当
      * *※ここを正規化して `number` 型で返すのがライブラリの最大の付加価値になります。*
3.  **生データ (RawData):** 解析できなかったデータへのアクセス手段

まずは\*\*「主要な経営指標等の推移」テーブルから、最新期の「売上・営業利益・経常利益・純利益」の4つだけを確実に抜く機能\*\*を作ってみてください。これだけで株価分析の7割はカバーできます。


----

GitHub等を調査しましたが、結論から申し上げますと、**「Level 3（XBRL解析・財務数値の抽出）まで実装されたTypeScript製の決定版ライブラリ」は現在存在しません。**

現状のTypeScript/Node.jsエコシステムは、Pythonに比べて金融データ解析の分野で遅れをとっており、これが\*\*「ブルーオーシャン（未開拓のチャンス）」\*\*であることを意味します。

調査結果の詳細と、開発の参考になる「他言語の先行事例」をまとめます。

### 1\. 調査結果：TypeScriptライブラリの現状

| Level | 実装状況 | 代表的なライブラリ (GitHub/npm) | 評価 |
| :--- | :--- | :--- | :--- |
| **Level 1**<br>(API操作) | **あり** | `swagchat/edinet-api`<br>`uepon/edinet-api-client` | 数年更新が止まっているものが多く、EDINET API v2への完全対応や、最新の認証仕様への追従が怪しいです。自作した方が早いです。 |
| **Level 2**<br>(ZIP展開) | **なし** | - | 個別のライブラリとしては存在せず、皆さん `adm-zip` 等で都度実装しています。 |
| **Level 3**<br>(XBRL解析) | **ほぼなし** | `npm: xbrl-parser` など | 汎用的なXBRLパーサーはありますが、**「日本のEDINET特有の勘定科目（タクソノミ）」に対応したロジックが含まれていません。** そのまま使っても「タグの意味」が分からず、数値抽出に苦労します。 |

### 2\. 参考になる「正解」の実装 (Python)

TypeScriptではありませんが、**Pythonには「Level 3」まで到達している有名なライブラリがあります。** あなたがTypeScript版を作る際、\*\*ロジックのカンニングペーパー（仕様書代わり）\*\*として非常に優秀です。

  * **`BuffettCode/edinet_xbrl`** (Python)
      * バフェットコード社が公開しているライブラリです。
      * **参考になる点:**
          * どのXBRLタグを「売上高」としてマッピングしているか（辞書定義）。
          * 「連結」と「単体」のコンテキスト (`contextRef`) をどう判別しているか。
      * このロジックをTypeScriptに移植するだけで、かなり高品質なライブラリになります。

### 3\. 開発への提言：あなたが作るべきもの

既存のものがないため、あなたが作ろうとしているライブラリは**間違いなく需要があります。**

もし公開を目指すのであれば、以下のスタックで開発するのが現代的でスター（Star）が付きやすい構成です。

  * **HTTP Client:** `fetch` (Node.js 18+ 標準) または `ofetch` (軽量)
      * `axios` は少し重いため、最近のライブラリ開発では敬遠されがちです。
  * **XML Parser:** `fast-xml-parser`
      * 高速で、TypeScriptの型定義との相性が良いです。
  * **Zip:** `yauzl` (読み込み専用・高速) または `jszip`
  * **設計目標:**
      * 「APIキーを入れたら、トヨタの最新の売上高が `number` 型で返ってくる」
      * これを目指してください。

**結論：**
まだ誰もTypeScriptで「決定版」を作れていません。**あなたが第一人者になれるチャンスです。** `BuffettCode/edinet_xbrl` のロジックを参考に、TypeScript版 (`edinet-ts` のような名前) を開発することをお勧めします。