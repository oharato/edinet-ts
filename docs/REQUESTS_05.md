edinetを検索するときは必ず銘柄コードを指定する？銘柄コードを指定しないで検索するのはどういう状況？

----

結論から申し上げますと、**「銘柄コード（Ticker）を指定しない検索」は、株価分析において非常に重要**であり、むしろ\*\*「プロの投資家ほどコードを指定しない検索（横断検索）を多用する」\*\*傾向にあります。

ご自身で作るライブラリ `edinet-ts` の設計に関わりますので、具体的なユースケース（＝なぜコードなしで検索したいのか）を4つのパターンに整理しました。

-----

### パターン1. 「誰が買ったか？」を知りたい時 (大量保有報告書)

これが最も頻出するケースです。

  * **状況:** 「有名な投資家（ウォーレン・バフェット、村上ファンド、ブラックロックなど）が、最近どの株を買い増したか知りたい。」
  * **検索キー:** 銘柄コードではなく、\*\*「提出者名（Filer Name）」**や**「提出者EDINETコード」\*\*で検索します。
  * **例:**
      * 銘柄コードで検索 → 「トヨタの株主構成」しか分かりません。
      * 提出者名「バークシャー・ハサウェイ」で検索 → \*\*「彼らが保有している全銘柄リスト」\*\*が分かります。

### パターン2. 「市場で何が起きているか？」を知りたい時 (イベントドリブン)

特定の会社ではなく、特定の「イベント」を探すケースです。

  * **状況:** 「今日、TOB（株式公開買付）が発表された銘柄をすべて知りたい。」
  * **検索キー:** \*\*「書類種別コード（Doc Type Code）」\*\*だけで検索します。
  * **例:**
      * 書類種別 `070` (公開買付届出書) でフィルタリングすると、\*\*「現在TOBがかけられている企業リスト」\*\*が一瞬で手に入ります。これはデイトレーダーにとって宝の山です。

### パターン3. 上場前の企業 (IPO) を分析したい時

  * **状況:** 「来月上場する予定の会社の、詳細な財務データが見たい。」
  * **理由:** 上場承認前や直後の企業は、まだ証券コード（Ticker）がシステム上で有効でなかったり、EDINET上ではコードなし（空欄）として扱われたりすることがあります。
  * **検索キー:** **「提出者名」** または **「有価証券届出書（新規公開時）」** という書類種別で探します。

### パターン4. 投資信託・REIT・ETFの分析

  * **状況:** 企業の株ではなく、ファンドの運用報告書を見たい。
  * **理由:** これらもEDINETに提出されますが、通常の4桁の証券コードとは異なる体系で管理されている場合が多いです。

-----

### ライブラリ `edinet-ts` への実装への影響

この事実を踏まえると、前回設計したSQLiteのテーブルとインデックス計画には、以下の**強化**が必要です。

#### 1\. スキーマ設計の修正

検索条件として「書類種別」や「提出者名」が頻繁に使われるため、これらにもインデックス（索引）を貼らないと、検索が遅くなります。

```sql
-- src/db/schema.ts の修正案

CREATE TABLE documents (
  doc_id TEXT PRIMARY KEY,
  sec_code TEXT,       -- 銘柄コード (72030)
  filer_name TEXT,     -- 提出者名 (ここでも検索したい)
  doc_type_code TEXT,  -- 書類種別 (ここでも検索したい)
  submit_date TEXT,    -- 提出日
  period_end TEXT
);

-- 【追加】 銘柄コードなし検索を爆速にするためのインデックス
CREATE INDEX idx_filer_name ON documents(filer_name);
CREATE INDEX idx_doc_type ON documents(doc_type_code);
```

#### 2\. メソッド設計の修正

`getFinancialHistory(ticker)` だけでなく、以下のような「銘柄コード不要の検索メソッド」を用意すると、ライブラリの価値が跳ね上がります。

```typescript
// edinet.ts のメソッド追加イメージ

/**
 * 特定の「イベント」が発生した書類を探す
 * 例: TOB(公開買付)が発表された書類を直近1ヶ月分取得
 */
async findDocumentsByType(docTypeCode: string, days: number = 30) {
  // SELECT * FROM documents WHERE doc_type_code = ? ...
}

/**
 * 特定の「投資家」が提出した書類を探す
 * 例: "株式会社光通信" が提出した大量保有報告書を探す
 */
async findDocumentsByFiler(filerNamePartial: string) {
  // SELECT * FROM documents WHERE filer_name LIKE ? ...
}
```

### まとめ

  * **銘柄コード指定:** 「その会社の深掘り（縦の分析）」に使います（財務諸表分析など）。
  * **銘柄コードなし:** 「市場全体のチャンス発見（横の分析）」に使います（TOB検知、著名投資家の動向監視など）。

あなたのライブラリがLv3（分析）を目指すのであれば、**「銘柄コードなし検索」への対応は必須機能**と言えます。